{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Ficha Veterin√°ria - {{ animal.apelido }}</title>
  <link rel="stylesheet" href="{% static 'petguard/veterinario.css' %}">
</head>

<body>

  <!-- CABE√áALHO -->
  <header class="header">
    <div class="header-left">
      <img src="{% static 'petguard/petlogobranco.png' %}" alt="Logo PETGUARD">
    </div>

    <div class="header-right">
      <img src="{% static 'petguard/iconepng.png' %}" alt="Usu√°rio">
    </div>
  </header>

  <!-- CONTE√öDO -->
  <div class="container">

    <!-- DADOS DO ANIMAL -->
    <div class="animal-header">
      {% if animal.foto %}
        <img src="{{ animal.foto.url }}" alt="Foto de {{ animal.apelido }}">
      {% else %}
        <img src="{% static 'petguard/icone-gato.png' %}" alt="Foto do animal">
      {% endif %}

      <div class="animal-info">
        <h2>{{ animal.apelido }}</h2>
        <p><strong>Idade:</strong> {{ animal.anos }} ano(s) e {{ animal.meses }} m√™s(es)</p>
        <p><strong>Esp√©cie:</strong> {{ animal.especie.nome }}</p>
        <p><strong>Ra√ßa:</strong> {{ animal.raca.nome }}</p>
        <p><strong>Status:</strong> {{ animal.get_status_display }}</p>
        <p><strong>Cadastrado em:</strong> {{ animal.created_at|date:"d/m/Y H:i" }}</p>
      </div>
    </div>

    <!-- MEDICA√á√ïES -->
    <div class="medicacoes">
      <h3>üíä Medica√ß√µes Registradas</h3>

      {% if medicacoes %}
        <ul>
          {% for m in medicacoes %}
            <li>
              <div>
                <strong>{{ m.nome }}</strong> ‚Äî {{ m.data_aplicacao|date:"d/m/Y" }}
                {% if m.observacoes %}
                  <br><small><em>{{ m.observacoes }}</em></small>
                {% endif %}
              </div>

              <div class="btn-group">
                <a href="{% url 'editar_medicacao' m.id %}" class="btn-editar">‚úèÔ∏è Editar</a>

                <a href="#" 
                   class="btn-excluir"
                   data-url="{% url 'deletar_medicacao' m.id %}"
                   onclick="abrirModal(this.dataset.url)">üóëÔ∏è Excluir</a>
              </div>
            </li>
          {% endfor %}
        </ul>

      {% else %}
        <p>Nenhuma medica√ß√£o registrada.</p>
      {% endif %}
    </div>

    <div class="add-medicacao">
      <h3>‚ûï Adicionar Nova Medica√ß√£o</h3>
      <form method="POST">
        {% csrf_token %}

        <label for="nome">Nome da medica√ß√£o:</label>
        <input type="text" id="nome" name="nome" required placeholder="Ex: Antibi√≥tico XYZ">

        <label for="observacoes">Observa√ß√µes:</label>
        <textarea id="observacoes" name="observacoes" rows="3" placeholder="Ex: Adicionar observa√ß√µes..."></textarea>

        <button type="submit">Salvar Medica√ß√£o</button>
      </form>
    </div>

    <a href="{% url 'index' %}" class="back-btn">‚¨ÖÔ∏è Voltar</a>
  </div>

  <div id="modal-overlay" class="modal-overlay">
    <div class="modal">
      <h3>Excluir Medica√ß√£o</h3>
      <p>Tem certeza que deseja excluir esta medica√ß√£o?</p>

      <button id="confirm-delete" class="confirm">Sim, excluir</button>
      <button id="cancel-delete" class="cancel">Cancelar</button>
    </div>
  </div>

  <script>
    let deleteUrl = "";

    function abrirModal(url) {
      deleteUrl = url;
      document.getElementById("modal-overlay").style.display = "flex";
    }

    document.getElementById("cancel-delete").onclick = function() {
      document.getElementById("modal-overlay").style.display = "none";
    };

    document.getElementById("confirm-delete").onclick = function() {
      window.location.href = deleteUrl;
    };
  </script>

</body>
</html>
