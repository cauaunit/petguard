{% load static %}
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login PetGuard</title>
    <link rel="stylesheet" href="{% static 'petguard/login.css' %}">
</head>
<body>
    <div class="login-card">
        <div class="logo-container">
            <img src="{% static 'petguard/petlogo.png' %}" alt="Logo PetGuard">
        </div>
        <p>Entre na sua conta</p>
        <form method="POST" action="" id="loginForm">
            {% csrf_token %}
            {% if error_message %}
            <div class="error">{{ error_message }}</div>
            {% endif %}
            <label for="usuario">Usuário:</label>
            <input type="text" id="usuario" name="username" placeholder="Digite seu usuário" required>
            <label for="senha">Senha:</label>
            <input type="password" id="senha" name="password" placeholder="Digite sua senha" required>
            <button type="submit">Entrar</button>
        </form>
        <div class="footer">
            <p>Esqueceu sua senha? <a href="{% url 'recuperar_senha' %}">Recuperar</a></p>
        </div>
        {% if messages %}
            {% for message in messages %}
                <p style="color:red">{{ message }}</p>
            {% endfor %}
        {% endif %}
    </div>

    <script>
        const form = document.getElementById("loginForm");

        form.addEventListener("submit", async (e) => {
            e.preventDefault();

            const username = document.getElementById("usuario").value;
            const password = document.getElementById("senha").value;
            const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]').value;

            const response = await fetch("", {
                method: "POST",
                headers: {
                    "Content-Type": "application/x-www-form-urlencoded",
                    "X-CSRFToken": csrfToken
                },
                body: new URLSearchParams({
                    username: username,
                    password: password
                })
            });

            if (response.redirected) {
                window.location.href = response.url;
            } else {
                let errorDiv = document.querySelector(".error");
                if (!errorDiv) {
                    errorDiv = document.createElement("div");
                    errorDiv.className = "error";
                    errorDiv.style.color = "red";
                    errorDiv.style.marginTop = "10px";
                    form.prepend(errorDiv);
                }
                errorDiv.textContent = "Usuário ou senha incorretos.";
            }
        });
    </script>
</body>
</html>
